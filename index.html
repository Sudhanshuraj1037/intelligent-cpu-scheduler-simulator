<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intelligent CPU Scheduler Simulator</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { font-family: Inter, system-ui; }
    .glass { background: rgba(255,255,255,0.04); backdrop-filter: blur(6px); }
    .gantt-bar {
      background: linear-gradient(90deg,#22d3ee,#34d399);
      color: #020617;
      font-weight: 600;
      text-align: center;
      border-right: 1px solid #02061755;
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-[#071013] via-[#0b1720] to-[#071013] text-slate-100 p-6">

<div class="max-w-7xl mx-auto">

<header class="mb-6">
  <h1 class="text-3xl font-extrabold">Intelligent CPU Scheduler Simulator</h1>
  <p class="text-slate-400 text-sm">FCFS · SJF · Priority · Round Robin</p>
</header>

<main class="grid lg:grid-cols-3 gap-6">

<section class="lg:col-span-1 space-y-6">

<div class="p-4 rounded-2xl glass border border-slate-700">
  <h2 class="font-semibold mb-3">Add Process</h2>
  <input id="pid" placeholder="PID (optional)" class="w-full mb-2 px-3 py-2 bg-transparent border border-slate-700 rounded">
  <input id="arrival" placeholder="Arrival Time" type="number" class="w-full mb-2 px-3 py-2 bg-transparent border border-slate-700 rounded">
  <input id="burst" placeholder="Burst Time" type="number" class="w-full mb-2 px-3 py-2 bg-transparent border border-slate-700 rounded">
  <input id="priority" placeholder="Priority" type="number" class="w-full mb-2 px-3 py-2 bg-transparent border border-slate-700 rounded">

  <button id="addBtn" class="w-full bg-cyan-400 text-slate-900 py-2 rounded font-semibold">Add Process</button>
</div>

<div class="p-4 rounded-2xl glass border border-slate-700">
  <h2 class="font-semibold mb-3">Algorithm</h2>

  <div class="grid grid-cols-2 gap-2 mb-2">
    <button data-a="fcfs" class="algo bg-slate-800 p-2 rounded">FCFS</button>
    <button data-a="sjf" class="algo bg-slate-800 p-2 rounded">SJF</button>
    <button data-a="priority" class="algo bg-slate-800 p-2 rounded">Priority</button>
    <button data-a="rr" class="algo bg-slate-800 p-2 rounded">Round Robin</button>
  </div>

  <input id="quantum" placeholder="Time Quantum (RR)" type="number"
    class="w-full px-3 py-2 bg-transparent border border-slate-700 rounded mb-2">

  <button id="runBtn" class="w-full bg-amber-400 text-slate-900 py-2 rounded font-semibold">
    Run Scheduler
  </button>
</div>

</section>

<section class="lg:col-span-2 space-y-6">

<div class="p-4 rounded-2xl glass border border-slate-700">
  <h2 class="font-semibold mb-2">Gantt Chart</h2>
  <div id="gantt" class="flex h-14 border border-slate-800 overflow-x-auto"></div>
</div>

<div class="p-4 rounded-2xl glass border border-slate-700">
  <h2 class="font-semibold mb-2">Metrics</h2>
  <table class="w-full text-sm">
    <thead>
      <tr class="text-slate-300">
        <th>PID</th><th>CT</th><th>TAT</th><th>WT</th>
      </tr>
    </thead>
    <tbody id="metrics"></tbody>
  </table>

  <div class="mt-3 text-sm text-slate-300">
    Avg TAT: <span id="avgTat">-</span> |
    Avg WT: <span id="avgWt">-</span>
  </div>
</div>

</section>
</main>
</div>

<script>
let processes = [], algo = null, pidc = 1;

document.querySelectorAll(".algo").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll(".algo").forEach(x=>x.classList.remove("bg-cyan-400","text-black"));
    b.classList.add("bg-cyan-400","text-black");
    algo=b.dataset.a;
  };
});

addBtn.onclick=()=>{
  let pid = pid.value || "P"+pidc++;
  processes.push({
    pid,
    arrival:+arrival.value,
    burst:+burst.value,
    priority:+priority.value
  });
};

function fcfs(p){
  p=[...p].sort((a,b)=>a.arrival-b.arrival);
  let t=0,s=[];
  p.forEach(x=>{
    if(t<x.arrival)t=x.arrival;
    s.push({pid:x.pid,start:t,end:t+x.burst});
    t+=x.burst;
  });
  return s;
}

function sjf(p){
  let t=0,s=[],done=[];
  while(done.length<p.length){
    let a=p.filter(x=>x.arrival<=t&&!done.includes(x));
    if(a.length==0){t++;continue;}
    a.sort((a,b)=>a.burst-b.burst);
    let x=a[0];
    s.push({pid:x.pid,start:t,end:t+x.burst});
    t+=x.burst; done.push(x);
  }
  return s;
}

function priorityAlgo(p){
  let t=0,s=[],done=[];
  while(done.length<p.length){
    let a=p.filter(x=>x.arrival<=t&&!done.includes(x));
    if(a.length==0){t++;continue;}
    a.sort((a,b)=>a.priority-b.priority);
    let x=a[0];
    s.push({pid:x.pid,start:t,end:t+x.burst});
    t+=x.burst; done.push(x);
  }
  return s;
}

function rr(p,q){
  let t=0,s=[],rem={},q1=[];
  p.forEach(x=>rem[x.pid]=x.burst);
  p=[...p].sort((a,b)=>a.arrival-b.arrival);
  let i=0;
  while(q1.length||i<p.length){
    while(i<p.length&&p[i].arrival<=t)q1.push(p[i++]);
    if(!q1.length){t++;continue;}
    let x=q1.shift();
    let e=Math.min(q,rem[x.pid]);
    s.push({pid:x.pid,start:t,end:t+e});
    t+=e; rem[x.pid]-=e;
    while(i<p.length&&p[i].arrival<=t)q1.push(p[i++]);
    if(rem[x.pid]>0)q1.push(x);
  }
  return s;
}

function draw(schedule){
  gantt.innerHTML="";
  let end=schedule.at(-1).end;
  schedule.forEach(x=>{
    let d=document.createElement("div");
    d.className="gantt-bar";
    d.style.width=((x.end-x.start)/end*100)+"%";
    d.textContent=x.pid;
    gantt.appendChild(d);
  });
}

function metricsCalc(p,s){
  let ct={},sumT=0,sumW=0;
  s.forEach(x=>ct[x.pid]=x.end);
  metrics.innerHTML="";
  p.forEach(x=>{
    let tat=ct[x.pid]-x.arrival;
    let wt=tat-x.burst;
    sumT+=tat; sumW+=wt;
    metrics.innerHTML+=`<tr><td>${x.pid}</td><td>${ct[x.pid]}</td><td>${tat}</td><td>${wt}</td></tr>`;
  });
  avgTat.textContent=(sumT/p.length).toFixed(2);
  avgWt.textContent=(sumW/p.length).toFixed(2);
}

runBtn.onclick=()=>{
  let s;
  if(algo=="fcfs")s=fcfs(processes);
  if(algo=="sjf")s=sjf(processes);
  if(algo=="priority")s=priorityAlgo(processes);
  if(algo=="rr")s=rr(processes,+quantum.value);
  draw(s); metricsCalc(processes,s);
};
</script>

</body>
</html>
